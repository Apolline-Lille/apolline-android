sudo: required
services:
  - docker
language: android
jdk: oraclejdk8
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -rf $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - $HOME/.gradle/caches/
  - $HOME/.gradle/wrapper/
  - $HOME/.android/build-cache
before_install:
  - chmod +x scripts/tag.sh
  - docker pull influxdb
  - docker run --name=influxdb -d -p 127.0.0.1:8086:8086 influxdb
  - docker ps -a
env:
 global:
 - ANDROID_API_LEVEL=26
 - ANDROID_BUILD_TOOLS=26.0.2
 - ADB_INSTALL_TIMEOUT=5 # Minutes.
 - secure: "lYFnvihaPRXu97v1emVFawOlzExUGFayzzA4fqFEaBdPfvJSMMCcZJUOPFJQKmFmUzVdH1ib5z2DuaLgy+vWQKT0ILODAwa+24O3EXbfpJxdMgdrS/h8zC6QsPZ16BmJUeoaavLejQh4WPFb7zqD//NH6XRpfQT69PdB0sSl7lKFvGjmPx9iHsnW5petNYNhT3S7zSy/xWf/MPDRMf0nUmf8hdiXsmZRH+pByC1BccsUiEYa5HrIcb69KGfpMH9EaNLuaquvV45RyCmlq+glOg2xvW1JII13D+GRoAOLHq1zuqLtShnWJNmOuvfvx0tsOXIOgNJxi5xVRwWU3QjykfZMtwSJfCM133yz3QfDKOlNvbiFbVlgV0LWwxQQi5fFQPOTGYZd6TH2b/7/Cg5hgaQvmU2mWHUIL/Q/uvl+T3rJVLlLh0BIeTTandfFwoPJtRAmvPZl7zXCwv5ocEK7knSG/uGZB8t1ceagxxt5cUb3CZrAg7MiOhO6uHnevozmnQCZDvBrQ5iWmWgIFlem6HZMAr0e4X2OVRTmaHdX2OH8pyryhMyCpMyRBm8XbCrkFSPK74YFgb7/5YnMlsciYLkb8rkSsqouvy8DYJMC/Huaa+CCQh0goygFo6wHJLYPRig17UvoCorzB0vUUZ72Lmbs6BKfV9InknXdAfywLL8=" #StorePass
 - secure: "ig65OGCzLAx2J6R3HYQqE+K/s8SpBLjWGad182G3XMgDQ122c+6seXANhwQcWEjGjZ1uTKuuSoKqampEqLXJGMlMbpz4kYiIVCj8j21ZFz2HaVcReFUJbeFHZ6hKC2+HS5AF8wfub+1Q8DTrnHFNoccbxjA9Z+vaG49jj+Io8wJXsN+5rIzUeB3uG1aY5CL+pNk3i8jQkSPhuCMWmW1PduuzrhTnHKQdrDOikuq+FhjaJgod0lBabs2iJwT1Q4srjCwhWQgDD2AwWrxwzjX3AAou5Xjb1eDwlFSE/mWPA032HAwgxhQ9TyEuRYsaQu3G5edYzFPt92BwegN2rKTZicJeMgzzixMaDixylzEAEaA/24QzplTLUuHFmv3kh/LvVm/8G5PA1jeHDb0ljXmItM6knKrseUjF1YHmJHi5Fms0y9Ec4IFaTPEadEraLKHtStrFYuPdmbgnU9yVmy7Ef0jAuGxfvEg6yV0tM4N4qF35sv3gPXNgrsyL8C5qSauWnUa2tXI9x1lFjg8JKt22PLkLq+2FoHcNGXxqnrzTkahc9RsqLIkx5LsGqu3bbYigTZrR6s6WJFzNdNFx3/sdejVCfJyqtQdLgXkBG1OzO23+3Mq8ySlLz+wI844D/ZHCYabcHEY7cmMNzMuDpjV2ym7ZwaYiow4+oZjlTcml/FA=" #KeyPass
 - secure: "myjOpzRzwA+/9KKWHG3RxlDvCBlsBDHV6UmXogBwKl71AAtNfzNCoEKCL9HH2tW0uyn1SEfnxT3HfwDtMMVJVzjKjR31WqEy7BPvrcZUn8pbMHyVOeuIAULd12cvtfxK2kqjR19POo3KAN7Fnm4GZWkUtfT+/gVuiV6u4DlCM3qbYLRzkuuiaPDZcY3aJe5IYe/kP4V4E9xOH5G6LvCXpNE0dSOzAcgjpiGt2eCopiaX5+W1kWjJHkODvpI3kBbYufZXf7pcpErycDVQcJkFEQck9LP9bJfR34TtULAz4TC5K8hNgkDHkEQJzwulWk8l2iAApZxWINQ6Ds90g0VptlBXQ04VVaFkq1j6pJEj5/lXbOn/rIPTqSDFyVs3hTOsUVgEPU1ReMhYUwR1rsuuNAJ/cO9PXdaHZtbKKtVsLRE3OKtWTQgFXgeT0oPT6IG7MTxwsBejx4101ttVsIm35GMVIEYhuR4rLg6G5fsrWITCgmvVxH8EKc5kT2B5R5RxzQ68FRnAE+Pn4JnjYZLUAdU689QeK9j1q/0N8fSH0kK3XP8hS9+ARPzGWpd4cojgdsf0LDnaa7nQZNVt+HrtadFVKjihmBsLyJobTmEDpEfrHusZNBiR+LBIMYVxnVQ/LwqnPnlXGsdeFZcGNogoH77PP12xvIoEiqtUgb708TA=" #GH_TOKEN
android:
  components:
  - tools
  - platform-tools
  - tools # Running this twice get's the latest build tools
  - android-$ANDROID_API_LEVEL
  - build-tools-$ANDROID_BUILD_TOOLS
  - extra
script:
 - android list target
 - curl -i -XPOST http://127.0.0.1:8086/query --data-urlencode "q=CREATE DATABASE test"
 - ./gradlew clean test build
before_deploy:
- openssl aes-256-cbc -K $encrypted_c4a232eaf55b_key -iv $encrypted_c4a232eaf55b_iv -in ApollineKeyStore.jks.enc -out ApollineKeyStore.jks -d
- cd app/build/outputs/apk/release
- jarsigner -verbose -sigalg SHA1withRSA -digestalg SHA1 -keystore ${TRAVIS_BUILD_DIR}/ApollineKeyStore.jks -storepass $storepass -keypass $keypass app-release-unsigned.apk apolline
- jarsigner -verify app-release-unsigned.apk
- "${ANDROID_HOME}/build-tools/${ANDROID_BUILD_TOOLS}/zipalign -v 4 app-release-unsigned.apk Apolline.apk"
deploy:
  provider: releases
  file: "app/build/outputs/apk/release/Apolline.apk"
  skip_cleanup: true
  overwrite: true
  api_key:
    secure: "wNyHnxqWJcwqR6ZwxkY8/xh/7yWedut5c+PX+0aaNtL+xBDzbXlFyf5SqwKrG3/UN+JtiVVtjomrzE7MALiHEUpeqmA1jT5BwirFwB7hFYSHu26p4pwsanZM1tkZxkGW8rlLx75qrud70MOboi3nb2ZoAaJk27khfTViDv8BowrPFTG6X26Lzg0P0dD94s+24cB7KtcdmBlkZvp8uK1xfLYQflAUGPRpFC0lPJujqODZXTyqapXQZPcCDOvG+A1iKNWR175EuAgSwdcqLqp3cB6KGZJ+44ODE2zv3W9sR9bSQ0xQqYjBRaCeIwNmpRyB8UW4rY8zTw/gput2gV/nJZBBE+xDsuLTSVRuqSABTRfPzJVYy6QJ2R936/EIIsIdyzU45a7k48hHOQFWiopabBxm0uilS7T0Y1PNuOUln3SABL7igjGfaPeNH511F9qUDdSUuvaNEFialUk5L7V6syPb8tYQ/sJDRZjE9gk6V5J8Z+Ig9pw9lD/3SAPIi1f5bVD1WNhfy7tHWR4Y+s5gZ7B0T76SKmiVIcgolBTEx0OXiG0Z2ML5pRw8zkj0R016Wq/kjeSqJlQnKFhbLFFB4ZzDH6ac6jIz6FOYqv0gBd5FzoSY31+34CoVaKqEhnCFCtjpR6tVGIHMbRkaSECwCKU4LITTl8borVr3yUly0+8=" #ApiGitHubRawToken
  on:
    repo: Apolline-Lille/apolline-android
    tags: true




